# smoothbrain-arena
A very simple library that implements an arena allocator in 100% golang.


<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# sbarena

```go
import "github.com/barbell-math/smoothbrain-arena"
```

## Index

- [Constants](<#constants>)
- [Variables](<#variables>)
- [func Alloc\[T any\]\(a \*Arena\) \(weak.Pointer\[T\], error\)](<#Alloc>)
- [func BucketSizeBytes\(a \*Arena\) uintptr](<#BucketSizeBytes>)
- [func Clear\(a \*Arena\)](<#Clear>)
- [func NumBuckets\(a \*Arena\) int](<#NumBuckets>)
- [func Reset\(a \*Arena\)](<#Reset>)
- [func TotalMemBytes\(a \*Arena\) uintptr](<#TotalMemBytes>)
- [type Arena](<#Arena>)
  - [func NewArena\(bucketSizeBytes uintptr\) \*Arena](<#NewArena>)


## Constants

<a name="DefaultBlockSize"></a>

```go
const (
    // 64 Kib. The default bucket size used when a bucket size <=0 is supplied
    // to [NewArena].
    DefaultBlockSize uintptr = 65536
)
```

## Variables

<a name="ValueToLargeErr"></a>

```go
var (
    ValueToLargeErr = errors.New(
        "The supplied value was to large to place in the arena",
    )
)
```

<a name="Alloc"></a>
## func [Alloc](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L89>)

```go
func Alloc[T any](a *Arena) (weak.Pointer[T], error)
```

Allocates enough space in the arena to hold a value of type T. The size of T must be less than the bucket size the allocator was initilized with, otherwise a [ValueToLargeErr](<#ValueToLargeErr>) will be returned.

<a name="BucketSizeBytes"></a>
## func [BucketSizeBytes](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L71>)

```go
func BucketSizeBytes(a *Arena) uintptr
```

Returns the bucket size for the given arena.

<a name="Clear"></a>
## func [Clear](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L145>)

```go
func Clear(a *Arena)
```

Frees all of the memory that the arena allocated. Calling this function will result in all other pointers that reference this arenas memory to be set to nil.

The arena can still be used after this operation, it will allocate more memory as needed. If this arena is used to allocate more memory the old memory will not be reused.

<a name="NumBuckets"></a>
## func [NumBuckets](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L76>)

```go
func NumBuckets(a *Arena) int
```

Gets the number of buckets that the arena has currently allocated.

<a name="Reset"></a>
## func [Reset](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L128>)

```go
func Reset(a *Arena)
```

Resets the internal state of the arena so that it starts to reuse memory, overwriting the memory it previously used.

No new memory will be allocated and as such all other pointers that reference this arenas memory can still be used, though they are no longer guarinteed to point to valid values.

<a name="TotalMemBytes"></a>
## func [TotalMemBytes](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L82>)

```go
func TotalMemBytes(a *Arena) uintptr
```

Returns the total number of bytes the arena has allocated accross all buckets.

<a name="Arena"></a>
## type [Arena](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L30-L36>)

A dynamic arena allocator that is backed by buckets. Objects that are larger than the bucket size cannot be stored in the area. The bucket size can be specified when calling [NewArena](<#NewArena>).

Go is a GC'ed language, so you cannot control exactly when the GC will free the arena but when it does all of the objects that it stores will be freed along with it. The GC cleaning up the Arena struct is equivalent to freeing all of the memory.

An Arena is thread safe for allocations and frees, though once the arena is freed all pointers to the data it contained will be invalidated and set to nil.

An Arena should \*not\* be copied by value, this will invalidate the atomics protecting allocation operations.

```go
type Arena struct {
    // contains filtered or unexported fields
}
```

<a name="NewArena"></a>
### func [NewArena](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L57>)

```go
func NewArena(bucketSizeBytes uintptr) *Arena
```

Creates a new [Arena](<#Arena>) allocator, initilizing it to use \`bucketSizeBytes\` bucket size.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# sbarena

```go
import "github.com/barbell-math/smoothbrain-arena"
```

## Index

- [Constants](<#constants>)
- [Variables](<#variables>)
- [func Alloc\[T any\]\(a \*Arena\) \(weak.Pointer\[T\], error\)](<#Alloc>)
- [func BucketSizeBytes\(a \*Arena\) uintptr](<#BucketSizeBytes>)
- [func Clear\(a \*Arena\)](<#Clear>)
- [func NumBuckets\(a \*Arena\) int](<#NumBuckets>)
- [func Reset\(a \*Arena\)](<#Reset>)
- [func TotalMemBytes\(a \*Arena\) uintptr](<#TotalMemBytes>)
- [type Arena](<#Arena>)
  - [func NewArena\(bucketSizeBytes uintptr\) \*Arena](<#NewArena>)


## Constants

<a name="DefaultBlockSize"></a>

```go
const (
    // 64 Kib. The default bucket size used when a bucket size <=0 is supplied
    // to [NewArena].
    DefaultBlockSize uintptr = 65536
)
```

## Variables

<a name="ValueToLargeErr"></a>

```go
var (
    ValueToLargeErr = errors.New(
        "The supplied value was to large to place in the arena",
    )
)
```

<a name="Alloc"></a>
## func [Alloc](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L89>)

```go
func Alloc[T any](a *Arena) (weak.Pointer[T], error)
```

Allocates enough space in the arena to hold a value of type T. The size of T must be less than the bucket size the allocator was initialized with, otherwise a [ValueToLargeErr](<#ValueToLargeErr>) will be returned.

<a name="BucketSizeBytes"></a>
## func [BucketSizeBytes](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L71>)

```go
func BucketSizeBytes(a *Arena) uintptr
```

Returns the bucket size for the given arena.

<a name="Clear"></a>
## func [Clear](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L144>)

```go
func Clear(a *Arena)
```

Frees all of the memory that the arena allocated. Calling this function will cause all other pointers that reference this arenas memory to be set to nil.

The arena can still be used after this operation, it will allocate more memory as needed. If this arena is used to allocate more memory the old memory will not be reused.

<a name="NumBuckets"></a>
## func [NumBuckets](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L76>)

```go
func NumBuckets(a *Arena) int
```

Gets the number of buckets that the arena has currently allocated.

<a name="Reset"></a>
## func [Reset](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L128>)

```go
func Reset(a *Arena)
```

Resets the internal state of the arena so that it starts to reuse memory, overwriting the memory it previously used.

No new memory will be allocated and as such all other pointers that reference this arenas memory can still be used, though they are no longer guaranteed to point to valid values.

<a name="TotalMemBytes"></a>
## func [TotalMemBytes](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L82>)

```go
func TotalMemBytes(a *Arena) uintptr
```

Returns the total number of bytes the arena has allocated across all buckets.

<a name="Arena"></a>
## type [Arena](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L30-L36>)

A dynamic arena allocator that is backed by buckets. Objects that are larger than the bucket size cannot be stored in the area. The bucket size can be specified when calling [NewArena](<#NewArena>).

Go is a GC'ed language, so you cannot control exactly when the GC will free the arena but when it does all of the objects that it stores will be freed along with it. The GC cleaning up the Arena struct is equivalent to freeing all of the memory.

An Arena is thread safe for allocations and frees, though once the arena is freed all pointers to the data it contained will be invalidated and set to nil.

An Arena should \*not\* be copied by value, this will invalidate the atomics protecting allocation operations.

```go
type Arena struct {
    // contains filtered or unexported fields
}
```

<a name="NewArena"></a>
### func [NewArena](<https://github.com/barbell-math/smoothbrain-arena/blob/main/arena.go#L57>)

```go
func NewArena(bucketSizeBytes uintptr) *Arena
```

Creates a new [Arena](<#Arena>) allocator, initializing it to use \`bucketSizeBytes\` bucket size.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
